"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const bt=new Map;function fe(...s){for(const t of s){for(const[e,r]of Object.entries(t.classes))bt.set(r,e);for(const[e,r]of Object.entries(t.properties))bt.set(r,e)}}function ge(s){return bt.get(s)}function Ge(){return bt}const A={classes:{class:"https://atomicdata.dev/classes/Class",property:"https://atomicdata.dev/classes/Property",agent:"https://atomicdata.dev/classes/Agent",datatype:"https://atomicdata.dev/classes/Datatype",ontology:"https://atomicdata.dev/class/ontology"},properties:{allowsOnly:"https://atomicdata.dev/properties/allowsOnly",classtype:"https://atomicdata.dev/properties/classtype",datatype:"https://atomicdata.dev/properties/datatype",description:"https://atomicdata.dev/properties/description",incomplete:"https://atomicdata.dev/properties/incomplete",isA:"https://atomicdata.dev/properties/isA",isDynamic:"https://atomicdata.dev/properties/isDynamic",name:"https://atomicdata.dev/properties/name",parent:"https://atomicdata.dev/properties/parent",read:"https://atomicdata.dev/properties/read",recommends:"https://atomicdata.dev/properties/recommends",requires:"https://atomicdata.dev/properties/requires",shortname:"https://atomicdata.dev/properties/shortname",write:"https://atomicdata.dev/properties/write",publicKey:"https://atomicdata.dev/properties/publicKey",instances:"https://atomicdata.dev/properties/instances",properties:"https://atomicdata.dev/properties/properties",classes:"https://atomicdata.dev/properties/classes",isLocked:"https://atomicdata.dev/properties/isLocked",localId:"https://atomicdata.dev/properties/localId"}},vt={classes:{commit:"https://atomicdata.dev/classes/Commit"},properties:{subject:"https://atomicdata.dev/properties/subject",createdAt:"https://atomicdata.dev/properties/createdAt",lastCommit:"https://atomicdata.dev/properties/lastCommit",previousCommit:"https://atomicdata.dev/properties/previousCommit",signer:"https://atomicdata.dev/properties/signer",set:"https://atomicdata.dev/properties/set",push:"https://atomicdata.dev/properties/push",remove:"https://atomicdata.dev/properties/remove",destroy:"https://atomicdata.dev/properties/destroy",signature:"https://atomicdata.dev/properties/signature"}},Rt={classes:{collection:"https://atomicdata.dev/classes/Collection"},properties:{members:"https://atomicdata.dev/properties/collection/members",currentPage:"https://atomicdata.dev/properties/collection/currentPage",pageSize:"https://atomicdata.dev/properties/collection/pageSize",property:"https://atomicdata.dev/properties/collection/property",totalMembers:"https://atomicdata.dev/properties/collection/totalMembers",totalPages:"https://atomicdata.dev/properties/collection/totalPages",value:"https://atomicdata.dev/properties/collection/value",sortBy:"https://atomicdata.dev/properties/collection/sortBy",sortDesc:"https://atomicdata.dev/properties/collection/sortDesc",includeExternal:"https://atomicdata.dev/properties/collection/includeExternal"}},ye={classes:{article:"https://atomicdata.dev/classes/Article",bookmark:"https://atomicdata.dev/class/Bookmark",chatroom:"https://atomicdata.dev/classes/ChatRoom",currencyProperty:"https://atomicdata.dev/ontology/data-browser/class/currency-property",dateFormat:"https://atomicdata.dev/classes/DateFormat",displayStyle:"https://atomicdata.dev/class/DisplayStyle",document:"https://atomicdata.dev/classes/Document",floatRangeProperty:"https://atomicdata.dev/classes/FloatRangeProperty",folder:"https://atomicdata.dev/classes/Folder",formattedDate:"https://atomicdata.dev/classes/FormattedDate",formattedNumber:"https://atomicdata.dev/classes/FormattedNumber",importer:"https://atomicdata.dev/classes/Importer",message:"https://atomicdata.dev/classes/Message",numberFormat:"https://atomicdata.dev/classes/NumberFormat",paragraph:"https://atomicdata.dev/classes/elements/Paragraph",rangeProperty:"https://atomicdata.dev/classes/RangeProperty",selectProperty:"https://atomicdata.dev/classes/SelectProperty",table:"https://atomicdata.dev/classes/Table",tag:"https://atomicdata.dev/classes/Tag",template:"https://atomicdata.dev/ontology/data-browser/class/template"},properties:{color:"https://atomicdata.dev/properties/color",currency:"https://atomicdata.dev/ontology/data-browser/property/currency",customNodePositioning:"https://atomicdata.dev/properties/custom-node-positioning",dateFormat:"https://atomicdata.dev/properties/dateFormat",decimalPlaces:"https://atomicdata.dev/properties/decimalPlaces",displayStyle:"https://atomicdata.dev/property/display-style",elements:"https://atomicdata.dev/properties/documents/elements",emoji:"https://atomicdata.dev/properties/emoji",image:"https://atomicdata.dev/ontology/data-browser/property/image",imageUrl:"https://atomicdata.dev/properties/imageUrl",max:"https://atomicdata.dev/properties/max",maxFloat:"https://atomicdata.dev/properties/maxFloat",messages:"https://atomicdata.dev/properties/messages",min:"https://atomicdata.dev/properties/min",minFloat:"https://atomicdata.dev/properties/minFloat",nextPage:"https://atomicdata.dev/properties/nextPage",numberFormatting:"https://atomicdata.dev/properties/numberFormatting",preview:"https://atomicdata.dev/property/preview",publishedAt:"https://atomicdata.dev/properties/published-at",replyTo:"https://atomicdata.dev/properties/replyTo",resources:"https://atomicdata.dev/ontology/data-browser/property/resources",subResources:"https://atomicdata.dev/properties/subresources",tableColumnWidths:"https://atomicdata.dev/properties/tableColumnWidths",tags:"https://atomicdata.dev/properties/tags",url:"https://atomicdata.dev/property/url"}},nt={classes:{error:"https://atomicdata.dev/classes/Error",endpoint:"https://atomicdata.dev/classes/Endpoint",drive:"https://atomicdata.dev/classes/Drive",redirect:"https://atomicdata.dev/classes/Redirect",file:"https://atomicdata.dev/classes/File",invite:"https://atomicdata.dev/classes/Invite",endpointResponse:"https://atomicdata.dev/ontology/server/class/endpoint-response"},properties:{drives:"https://atomicdata.dev/properties/drives",results:"https://atomicdata.dev/properties/endpoint/results",property:"https://atomicdata.dev/properties/search/property",redirectAgent:"https://atomicdata.dev/properties/invite/redirectAgent",agent:"https://atomicdata.dev/properties/invite/agent",publicKey:"https://atomicdata.dev/properties/invite/publicKey",target:"https://atomicdata.dev/properties/invite/target",usagesLeft:"https://atomicdata.dev/properties/invite/usagesLeft",users:"https://atomicdata.dev/properties/invite/users",write:"https://atomicdata.dev/properties/invite/write",filename:"https://atomicdata.dev/properties/filename",filesize:"https://atomicdata.dev/properties/filesize",downloadUrl:"https://atomicdata.dev/properties/downloadURL",mimetype:"https://atomicdata.dev/properties/mimetype",attachments:"https://atomicdata.dev/properties/attachments",createdBy:"https://atomicdata.dev/properties/createdBy",checksum:"https://atomicdata.dev/properties/checksum",internalId:"https://atomicdata.dev/properties/internalId",children:"https://atomicdata.dev/properties/children",parameters:"https://atomicdata.dev/properties/endpoint/parameters",destination:"https://atomicdata.dev/properties/destination",status:"https://atomicdata.dev/ontology/server/property/status",responseMessage:"https://atomicdata.dev/ontology/server/property/response-message",defaultOntology:"https://atomicdata.dev/ontology/server/property/default-ontology",imageWidth:"https://atomicdata.dev/properties/imageWidth",imageHeight:"https://atomicdata.dev/properties/imageHeight"}};function Je(){fe(A,vt,Rt,ye,nt)}function gt(){return globalThis===globalThis.window}const qe={};/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const x=BigInt(0),g=BigInt(1),j=BigInt(2),be=BigInt(255),ie=j**BigInt(252)+BigInt("27742317777372353535851937790883648493"),R={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:j**be-BigInt(19),l:ie,n:ie,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")},ve=j**BigInt(256),ot=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742");const Ze=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),Ye=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),Xe=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),Qe=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");class v{constructor(t,e,r,o){this.x=t,this.y=e,this.z=r,this.t=o}static fromAffine(t){if(!(t instanceof E))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return t.equals(E.ZERO)?v.ZERO:new v(t.x,t.y,g,p(t.x*t.y))}static toAffineBatch(t){const e=ss(t.map(r=>r.z));return t.map((r,o)=>r.toAffine(e[o]))}static normalizeZ(t){return this.toAffineBatch(t).map(this.fromAffine)}equals(t){ae(t);const{x:e,y:r,z:o}=this,{x:i,y:a,z:n}=t,c=p(e*n),d=p(i*o),u=p(r*n),h=p(a*o);return c===d&&u===h}negate(){return new v(p(-this.x),this.y,this.z,p(-this.t))}double(){const{x:t,y:e,z:r}=this,{a:o}=R,i=p(t**j),a=p(e**j),n=p(j*p(r**j)),c=p(o*i),d=p(p((t+e)**j)-i-a),u=c+a,h=u-n,l=c-a,f=p(d*h),m=p(u*l),y=p(d*l),S=p(h*u);return new v(f,m,S,y)}add(t){ae(t);const{x:e,y:r,z:o,t:i}=this,{x:a,y:n,z:c,t:d}=t,u=p((r-e)*(n+a)),h=p((r+e)*(n-a)),l=p(h-u);if(l===x)return this.double();const f=p(o*j*d),m=p(i*j*c),y=m+f,S=h+u,P=m-f,B=p(y*l),w=p(S*P),O=p(y*P),k=p(l*S);return new v(B,w,k,O)}subtract(t){return this.add(t.negate())}precomputeWindow(t){const e=1+256/t,r=[];let o=this,i=o;for(let a=0;a<e;a++){i=o,r.push(i);for(let n=1;n<2**(t-1);n++)i=i.add(o),r.push(i);o=i.double()}return r}wNAF(t,e){!e&&this.equals(v.BASE)&&(e=E.BASE);const r=e&&e._WINDOW_SIZE||1;if(256%r)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let o=e&&Mt.get(e);o||(o=this.precomputeWindow(r),e&&r!==1&&(o=v.normalizeZ(o),Mt.set(e,o)));let i=v.ZERO,a=v.ZERO;const n=1+256/r,c=2**(r-1),d=BigInt(2**r-1),u=2**r,h=BigInt(r);for(let l=0;l<n;l++){const f=l*c;let m=Number(t&d);if(t>>=h,m>c&&(m-=u,t+=g),m===0){let y=o[f];l%2&&(y=y.negate()),a=a.add(y)}else{let y=o[f+Math.abs(m)-1];m<0&&(y=y.negate()),i=i.add(y)}}return v.normalizeZ([i,a])[0]}multiply(t,e){return this.wNAF(wt(t,R.l),e)}multiplyUnsafe(t){let e=wt(t,R.l,!1);const r=v.BASE,o=v.ZERO;if(e===x)return o;if(this.equals(o)||e===g)return this;if(this.equals(r))return this.wNAF(e);let i=o,a=this;for(;e>x;)e&g&&(i=i.add(a)),a=a.double(),e>>=g;return i}isSmallOrder(){return this.multiplyUnsafe(R.h).equals(v.ZERO)}isTorsionFree(){return this.multiplyUnsafe(R.l).equals(v.ZERO)}toAffine(t=At(this.z)){const{x:e,y:r,z:o}=this,i=p(e*t),a=p(r*t);if(p(o*t)!==g)throw new Error("invZ was invalid");return new E(i,a)}fromRistrettoBytes(){Ot()}toRistrettoBytes(){Ot()}fromRistrettoHash(){Ot()}}v.BASE=new v(R.Gx,R.Gy,g,p(R.Gx*R.Gy));v.ZERO=new v(x,g,g,x);function ae(s){if(!(s instanceof v))throw new TypeError("ExtendedPoint expected")}function Bt(s){if(!(s instanceof _))throw new TypeError("RistrettoPoint expected")}function Ot(){throw new Error("Legacy method: switch to RistrettoPoint")}class _{constructor(t){this.ep=t}static calcElligatorRistrettoMap(t){const{d:e}=R,r=p(ot*t*t),o=p((r+g)*Xe);let i=BigInt(-1);const a=p((i-e*r)*p(r+e));let{isValid:n,value:c}=Wt(o,a),d=p(c*t);K(d)||(d=p(-d)),n||(c=d),n||(i=r);const u=p(i*(r-g)*Qe-a),h=c*c,l=p((c+c)*a),f=p(u*Ze),m=p(g-h),y=p(g+h);return new v(p(l*y),p(m*f),p(f*y),p(l*m))}static hashToCurve(t){t=J(t,64);const e=kt(t.slice(0,32)),r=this.calcElligatorRistrettoMap(e),o=kt(t.slice(32,64)),i=this.calcElligatorRistrettoMap(o);return new _(r.add(i))}static fromHex(t){t=J(t,32);const{a:e,d:r}=R,o="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",i=kt(t);if(!os(at(i),t)||K(i))throw new Error(o);const a=p(i*i),n=p(g+e*a),c=p(g-e*a),d=p(n*n),u=p(c*c),h=p(e*r*d-u),{isValid:l,value:f}=ne(p(h*u)),m=p(f*c),y=p(f*m*h);let S=p((i+i)*m);K(S)&&(S=p(-S));const P=p(n*y),B=p(S*P);if(!l||K(B)||P===x)throw new Error(o);return new _(new v(S,P,g,B))}toRawBytes(){let{x:t,y:e,z:r,t:o}=this.ep;const i=p(p(r+e)*p(r-e)),a=p(t*e),{value:n}=ne(p(i*a**j)),c=p(n*i),d=p(n*a),u=p(c*d*o);let h;if(K(o*u)){let f=p(e*ot),m=p(t*ot);t=f,e=m,h=p(c*Ye)}else h=d;K(t*u)&&(e=p(-e));let l=p((r-e)*h);return K(l)&&(l=p(-l)),at(l)}toHex(){return ct(this.toRawBytes())}toString(){return this.toHex()}equals(t){Bt(t);const e=this.ep,r=t.ep,o=p(e.x*r.y)===p(e.y*r.x),i=p(e.y*r.y)===p(e.x*r.x);return o||i}add(t){return Bt(t),new _(this.ep.add(t.ep))}subtract(t){return Bt(t),new _(this.ep.subtract(t.ep))}multiply(t){return new _(this.ep.multiply(t))}multiplyUnsafe(t){return new _(this.ep.multiplyUnsafe(t))}}_.BASE=new _(v.BASE);_.ZERO=new _(v.ZERO);const Mt=new WeakMap;class E{constructor(t,e){this.x=t,this.y=e}_setWindowSize(t){this._WINDOW_SIZE=t,Mt.delete(this)}static fromHex(t,e=!0){const{d:r,P:o}=R;t=J(t,32);const i=t.slice();i[31]=t[31]&-129;const a=et(i);if(e&&a>=o)throw new Error("Expected 0 < hex < P");if(!e&&a>=ve)throw new Error("Expected 0 < hex < 2**256");const n=p(a*a),c=p(n-g),d=p(r*n+g);let{isValid:u,value:h}=Wt(c,d);if(!u)throw new Error("Point.fromHex: invalid y coordinate");const l=(h&g)===g;return(t[31]&128)!==0!==l&&(h=p(-h)),new E(h,a)}static async fromPrivateKey(t){return(await Et(t)).point}toRawBytes(){const t=at(this.y);return t[31]|=this.x&g?128:0,t}toHex(){return ct(this.toRawBytes())}toX25519(){const{y:t}=this,e=p((g+t)*At(g-t));return at(e)}isTorsionFree(){return v.fromAffine(this).isTorsionFree()}equals(t){return this.x===t.x&&this.y===t.y}negate(){return new E(p(-this.x),this.y)}add(t){return v.fromAffine(this).add(v.fromAffine(t)).toAffine()}subtract(t){return this.add(t.negate())}multiply(t){return v.fromAffine(this).multiply(t,this).toAffine()}}E.BASE=new E(R.Gx,R.Gy);E.ZERO=new E(x,g);class Lt{constructor(t,e){this.r=t,this.s=e,this.assertValidity()}static fromHex(t){const e=J(t,64),r=E.fromHex(e.slice(0,32),!1),o=et(e.slice(32,64));return new Lt(r,o)}assertValidity(){const{r:t,s:e}=this;if(!(t instanceof E))throw new Error("Expected Point instance");return wt(e,R.l,!1),this}toRawBytes(){const t=new Uint8Array(64);return t.set(this.r.toRawBytes()),t.set(at(this.s),32),t}toHex(){return ct(this.toRawBytes())}}function ts(...s){if(!s.every(r=>r instanceof Uint8Array))throw new Error("Expected Uint8Array list");if(s.length===1)return s[0];const t=s.reduce((r,o)=>r+o.length,0),e=new Uint8Array(t);for(let r=0,o=0;r<s.length;r++){const i=s[r];e.set(i,o),o+=i.length}return e}const es=Array.from({length:256},(s,t)=>t.toString(16).padStart(2,"0"));function ct(s){if(!(s instanceof Uint8Array))throw new Error("Uint8Array expected");let t="";for(let e=0;e<s.length;e++)t+=es[s[e]];return t}function we(s){if(typeof s!="string")throw new TypeError("hexToBytes: expected string, got "+typeof s);if(s.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const t=new Uint8Array(s.length/2);for(let e=0;e<t.length;e++){const r=e*2,o=s.slice(r,r+2),i=Number.parseInt(o,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");t[e]=i}return t}function Se(s){const e=s.toString(16).padStart(64,"0");return we(e)}function at(s){return Se(s).reverse()}function K(s){return(p(s)&g)===g}function et(s){if(!(s instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+ct(Uint8Array.from(s).reverse()))}function kt(s){return p(et(s)&j**be-g)}function p(s,t=R.P){const e=s%t;return e>=x?e:t+e}function At(s,t=R.P){if(s===x||t<=x)throw new Error(`invert: expected positive integers, got n=${s} mod=${t}`);let e=p(s,t),r=t,o=x,i=g;for(;e!==x;){const n=r/e,c=r%e,d=o-i*n;r=e,e=c,o=i,i=d}if(r!==g)throw new Error("invert: does not exist");return p(o,t)}function ss(s,t=R.P){const e=new Array(s.length),r=s.reduce((i,a,n)=>a===x?i:(e[n]=i,p(i*a,t)),g),o=At(r,t);return s.reduceRight((i,a,n)=>a===x?i:(e[n]=p(i*e[n],t),p(i*a,t)),o),e}function T(s,t){const{P:e}=R;let r=s;for(;t-- >x;)r*=r,r%=e;return r}function rs(s){const{P:t}=R,e=BigInt(5),r=BigInt(10),o=BigInt(20),i=BigInt(40),a=BigInt(80),c=s*s%t*s%t,d=T(c,j)*c%t,u=T(d,g)*s%t,h=T(u,e)*u%t,l=T(h,r)*h%t,f=T(l,o)*l%t,m=T(f,i)*f%t,y=T(m,a)*m%t,S=T(y,a)*m%t,P=T(S,r)*h%t;return{pow_p_5_8:T(P,j)*s%t,b2:c}}function Wt(s,t){const e=p(t*t*t),r=p(e*e*t),o=rs(s*r).pow_p_5_8;let i=p(s*e*o);const a=p(t*i*i),n=i,c=p(i*ot),d=a===s,u=a===p(-s),h=a===p(-s*ot);return d&&(i=n),(u||h)&&(i=c),K(i)&&(i=p(-i)),{isValid:d||u,value:i}}function ne(s){return Wt(g,s)}async function ce(...s){const t=await pt.sha512(ts(...s)),e=et(t);return p(e,R.l)}function os(s,t){if(s.length!==t.length)return!1;for(let e=0;e<s.length;e++)if(s[e]!==t[e])return!1;return!0}function J(s,t){const e=s instanceof Uint8Array?Uint8Array.from(s):we(s);if(typeof t=="number"&&e.length!==t)throw new Error(`Expected ${t} bytes`);return e}function wt(s,t,e=!0){if(!t)throw new TypeError("Specify max value");if(typeof s=="number"&&Number.isSafeInteger(s)&&(s=BigInt(s)),typeof s=="bigint"&&s<t){if(e){if(x<s)return s}else if(x<=s)return s}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function is(s){return s[0]&=248,s[31]&=127,s[31]|=64,s}async function Et(s){if(s=typeof s=="bigint"||typeof s=="number"?Se(wt(s,ve)):J(s),s.length!==32)throw new Error("Expected 32 bytes");const t=await pt.sha512(s),e=is(t.slice(0,32)),r=t.slice(32,64),o=p(et(e),R.l),i=E.BASE.multiply(o),a=i.toRawBytes();return{head:e,prefix:r,scalar:o,point:i,pointBytes:a}}async function Re(s){return(await Et(s)).pointBytes}async function as(s,t){s=J(s);const{prefix:e,scalar:r,pointBytes:o}=await Et(t),i=await ce(e,s),a=E.BASE.multiply(i),n=await ce(a.toRawBytes(),o,s),c=p(i+n*r,R.l);return new Lt(a,c).toRawBytes()}E.BASE._setWindowSize(8);const W={node:qe,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},pt={TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],bytesToHex:ct,getExtendedPublicKey:Et,mod:p,invert:At,hashToPrivateScalar:s=>{if(s=J(s),s.length<40||s.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");const t=p(et(s),R.l);if(t===x||t===g)throw new Error("Invalid private key");return t},randomBytes:(s=32)=>{if(W.web)return W.web.getRandomValues(new Uint8Array(s));if(W.node){const{randomBytes:t}=W.node;return new Uint8Array(t(s).buffer)}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>pt.randomBytes(32),sha512:async s=>{if(W.web){const t=await W.web.subtle.digest("SHA-512",s.buffer);return new Uint8Array(t)}else{if(W.node)return Uint8Array.from(W.node.createHash("sha512").update(s).digest());throw new Error("The environment doesn't have sha512 function")}},precompute(s=8,t=E.BASE){const e=t.equals(E.BASE)?t:new E(t.x,t.y);return e._setWindowSize(s),e.multiply(j),e}};function ns(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var cs=function(s,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var e=typeof t.cycles=="boolean"?t.cycles:!1,r=t.cmp&&function(i){return function(a){return function(n,c){var d={key:n,value:a[n]},u={key:c,value:a[c]};return i(d,u)}}}(t.cmp),o=[];return function i(a){if(a&&a.toJSON&&typeof a.toJSON=="function"&&(a=a.toJSON()),a!==void 0){if(typeof a=="number")return isFinite(a)?""+a:"null";if(typeof a!="object")return JSON.stringify(a);var n,c;if(Array.isArray(a)){for(c="[",n=0;n<a.length;n++)n&&(c+=","),c+=i(a[n])||"null";return c+"]"}if(a===null)return"null";if(o.indexOf(a)!==-1){if(e)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var d=o.push(a)-1,u=Object.keys(a).sort(r&&r(a));for(c="",n=0;n<u.length;n++){var h=u[n],l=i(a[h]);l&&(c&&(c+=","),c+=JSON.stringify(h)+":"+l)}return o.splice(d,1),"{"+c+"}"}}(s)};const ps=ns(cs);var X="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",st=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var ut=0;ut<X.length;ut++)st[X.charCodeAt(ut)]=ut;var St=function(s){var t=new Uint8Array(s),e,r=t.length,o="";for(e=0;e<r;e+=3)o+=X[t[e]>>2],o+=X[(t[e]&3)<<4|t[e+1]>>4],o+=X[(t[e+1]&15)<<2|t[e+2]>>6],o+=X[t[e+2]&63];return r%3===2?o=o.substring(0,o.length-1)+"=":r%3===1&&(o=o.substring(0,o.length-2)+"=="),o},Ae=function(s){var t=s.length*.75,e=s.length,r,o=0,i,a,n,c;s[s.length-1]==="="&&(t--,s[s.length-2]==="="&&t--);var d=new ArrayBuffer(t),u=new Uint8Array(d);for(r=0;r<e;r+=4)i=st[s.charCodeAt(r)],a=st[s.charCodeAt(r+1)],n=st[s.charCodeAt(r+2)],c=st[s.charCodeAt(r+3)],u[o++]=i<<2|a>>4,u[o++]=(a&15)<<4|n>>2,u[o++]=(n&3)<<6|c&63;return d};/*! noble-hashes - MIT License (c) 2021 Paul Miller (paulmillr.com) */const Tt=s=>new DataView(s.buffer,s.byteOffset,s.byteLength),ds=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!ds)throw new Error("Non little-endian hardware is not supported");Array.from({length:256},(s,t)=>t.toString(16).padStart(2,"0"));(()=>{const s=typeof module<"u"&&typeof module.require=="function"&&module.require.bind(module);try{if(s){const{setImmediate:t}=s("timers");return()=>new Promise(e=>t(e))}}catch{}return()=>new Promise(t=>setTimeout(t,0))})();function hs(s){if(typeof s!="string")throw new TypeError(`utf8ToBytes expected string, got ${typeof s}`);return new TextEncoder().encode(s)}function Ee(s){if(typeof s=="string"&&(s=hs(s)),!(s instanceof Uint8Array))throw new TypeError(`Expected input type is Uint8Array (got ${typeof s})`);return s}class us{clone(){return this._cloneInto()}}function zt(s){const t=r=>s().update(Ee(r)).digest(),e=s();return t.outputLen=e.outputLen,t.blockLen=e.blockLen,t.create=()=>s(),t.init=t.create,t}function ls(s,t,e,r){if(typeof s.setBigUint64=="function")return s.setBigUint64(t,e,r);const o=BigInt(32),i=BigInt(4294967295),a=Number(e>>o&i),n=Number(e&i),c=r?4:0,d=r?0:4;s.setUint32(t+c,a,r),s.setUint32(t+d,n,r)}class ms extends us{constructor(t,e,r,o){super(),this.blockLen=t,this.outputLen=e,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Tt(this.buffer)}update(t){if(this.destroyed)throw new Error("instance is destroyed");const{view:e,buffer:r,blockLen:o,finished:i}=this;if(i)throw new Error("digest() was already called");t=Ee(t);const a=t.length;for(let n=0;n<a;){const c=Math.min(o-this.pos,a-n);if(c===o){const d=Tt(t);for(;o<=a-n;n+=o)this.process(d,n);continue}r.set(t.subarray(n,n+c),this.pos),this.pos+=c,n+=c,this.pos===o&&(this.process(e,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){if(this.destroyed)throw new Error("instance is destroyed");if(!(t instanceof Uint8Array)||t.length<this.outputLen)throw new Error("_Sha2: Invalid output buffer");if(this.finished)throw new Error("digest() was already called");this.finished=!0;const{buffer:e,view:r,blockLen:o,isLE:i}=this;let{pos:a}=this;e[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>o-a&&(this.process(r,0),a=0);for(let c=a;c<o;c++)e[c]=0;ls(r,o-8,BigInt(this.length*8),i),this.process(r,0);const n=Tt(t);this.get().forEach((c,d)=>n.setUint32(4*d,c,i))}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const r=t.slice(0,e);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:r,length:o,finished:i,destroyed:a,pos:n}=this;return t.length=o,t.pos=n,t.finished=i,t.destroyed=a,o%e&&t.buffer.set(r),t}}const lt=BigInt(2**32-1),pe=BigInt(32);function fs(s,t=!1){return t?{h:Number(s&lt),l:Number(s>>pe&lt)}:{h:Number(s>>pe&lt)|0,l:Number(s&lt)|0}}function gs(s,t=!1){let e=new Uint32Array(s.length),r=new Uint32Array(s.length);for(let o=0;o<s.length;o++){const{h:i,l:a}=fs(s[o],t);[e[o],r[o]]=[i,a]}return[e,r]}const de=(s,t,e)=>s>>>e,he=(s,t,e)=>s<<32-e|t>>>e,q=(s,t,e)=>s>>>e|t<<32-e,Z=(s,t,e)=>s<<32-e|t>>>e,mt=(s,t,e)=>s<<64-e|t>>>e-32,ft=(s,t,e)=>s>>>e-32|t<<64-e;function D(s,t,e,r){const o=(t>>>0)+(r>>>0);return{h:s+e+(o/2**32|0)|0,l:o|0}}const ys=(s,t,e)=>(s>>>0)+(t>>>0)+(e>>>0),bs=(s,t,e,r)=>t+e+r+(s/2**32|0)|0,vs=(s,t,e,r)=>(s>>>0)+(t>>>0)+(e>>>0)+(r>>>0),ws=(s,t,e,r,o)=>t+e+r+o+(s/2**32|0)|0,Ss=(s,t,e,r,o)=>(s>>>0)+(t>>>0)+(e>>>0)+(r>>>0)+(o>>>0),Rs=(s,t,e,r,o,i)=>t+e+r+o+i+(s/2**32|0)|0,[As,Es]=gs(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(s=>BigInt(s))),z=new Uint32Array(80),H=new Uint32Array(80);class Ht extends ms{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:t,Al:e,Bh:r,Bl:o,Ch:i,Cl:a,Dh:n,Dl:c,Eh:d,El:u,Fh:h,Fl:l,Gh:f,Gl:m,Hh:y,Hl:S}=this;return[t,e,r,o,i,a,n,c,d,u,h,l,f,m,y,S]}set(t,e,r,o,i,a,n,c,d,u,h,l,f,m,y,S){this.Ah=t|0,this.Al=e|0,this.Bh=r|0,this.Bl=o|0,this.Ch=i|0,this.Cl=a|0,this.Dh=n|0,this.Dl=c|0,this.Eh=d|0,this.El=u|0,this.Fh=h|0,this.Fl=l|0,this.Gh=f|0,this.Gl=m|0,this.Hh=y|0,this.Hl=S|0}process(t,e){for(let w=0;w<16;w++,e+=4)z[w]=t.getUint32(e),H[w]=t.getUint32(e+=4);for(let w=16;w<80;w++){const O=z[w-15]|0,k=H[w-15]|0,Pt=q(O,k,1)^q(O,k,8)^de(O,k,7),Nt=Z(O,k,1)^Z(O,k,8)^he(O,k,7),M=z[w-2]|0,$=H[w-2]|0,dt=q(M,$,19)^mt(M,$,61)^de(M,$,6),Ut=Z(M,$,19)^ft(M,$,61)^he(M,$,6),ht=vs(Nt,Ut,H[w-7],H[w-16]),_t=ws(ht,Pt,dt,z[w-7],z[w-16]);z[w]=_t|0,H[w]=ht|0}let{Ah:r,Al:o,Bh:i,Bl:a,Ch:n,Cl:c,Dh:d,Dl:u,Eh:h,El:l,Fh:f,Fl:m,Gh:y,Gl:S,Hh:P,Hl:B}=this;for(let w=0;w<80;w++){const O=q(h,l,14)^q(h,l,18)^mt(h,l,41),k=Z(h,l,14)^Z(h,l,18)^ft(h,l,41),Pt=h&f^~h&y,Nt=l&m^~l&S,M=Ss(B,k,Nt,Es[w],H[w]),$=Rs(M,P,O,Pt,As[w],z[w]),dt=M|0,Ut=q(r,o,28)^mt(r,o,34)^mt(r,o,39),ht=Z(r,o,28)^ft(r,o,34)^ft(r,o,39),_t=r&i^r&n^i&n,Ve=o&a^o&c^a&c;P=y|0,B=S|0,y=f|0,S=m|0,f=h|0,m=l|0,{h,l}=D(d|0,u|0,$|0,dt|0),d=n|0,u=c|0,n=i|0,c=a|0,i=r|0,a=o|0;const oe=ys(dt,ht,Ve);r=bs(oe,$,Ut,_t),o=oe|0}({h:r,l:o}=D(this.Ah|0,this.Al|0,r|0,o|0)),{h:i,l:a}=D(this.Bh|0,this.Bl|0,i|0,a|0),{h:n,l:c}=D(this.Ch|0,this.Cl|0,n|0,c|0),{h:d,l:u}=D(this.Dh|0,this.Dl|0,d|0,u|0),{h,l}=D(this.Eh|0,this.El|0,h|0,l|0),{h:f,l:m}=D(this.Fh|0,this.Fl|0,f|0,m|0),{h:y,l:S}=D(this.Gh|0,this.Gl|0,y|0,S|0),{h:P,l:B}=D(this.Hh|0,this.Hl|0,P|0,B|0),this.set(r,o,i,a,n,c,d,u,h,l,f,m,y,S,P,B)}roundClean(){z.fill(0),H.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class xs extends Ht{constructor(){super(),this.Ah=573645204,this.Al=-64227540,this.Bh=-1621794909,this.Bl=-934517566,this.Ch=596883563,this.Cl=1867755857,this.Dh=-1774684391,this.Dl=1497426621,this.Eh=-1775747358,this.El=-1467023389,this.Fh=-1101128155,this.Fl=1401305490,this.Gh=721525244,this.Gl=746961066,this.Hh=246885852,this.Hl=-2117784414,this.outputLen=32}}class Cs extends Ht{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}}const js=zt(()=>new Ht);zt(()=>new xs);zt(()=>new Cs);var Kt=(s=>(s.ATOMIC_URL="https://atomicdata.dev/datatypes/atomicURL",s.BOOLEAN="https://atomicdata.dev/datatypes/boolean",s.DATE="https://atomicdata.dev/datatypes/date",s.FLOAT="https://atomicdata.dev/datatypes/float",s.INTEGER="https://atomicdata.dev/datatypes/integer",s.MARKDOWN="https://atomicdata.dev/datatypes/markdown",s.RESOURCEARRAY="https://atomicdata.dev/datatypes/resourceArray",s.SLUG="https://atomicdata.dev/datatypes/slug",s.STRING="https://atomicdata.dev/datatypes/string",s.TIMESTAMP="https://atomicdata.dev/datatypes/timestamp",s.UNKNOWN="unknown-datatype",s))(Kt||{});const Ps=new Set(Object.values(Kt)),xe=s=>Ps.has(s)?s:"unknown-datatype",Ns=/^[a-z0-9]+(?:-[a-z0-9]+)*$/,Us=/^\d{4}-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/,Ce=(s,t)=>{let e=null;if(s===void 0)throw new Error(`Value is undefined, expected ${t}`);switch(t){case"https://atomicdata.dev/datatypes/string":{if(!Y(s)){e="Not a string";break}break}case"https://atomicdata.dev/datatypes/markdown":{if(!Y(s)){e="Not a string";break}break}case"https://atomicdata.dev/datatypes/slug":{if(!Y(s)){e="Not a slug, not even a string";break}s.match(Ns)===null&&(e="Not a valid slug. Only lowercase letters and numbers with dashes `-` between them");break}case"https://atomicdata.dev/datatypes/atomicURL":{if(!Y(s)){e="Not a string. Should be a URL";break}U.tryValidSubject(s);break}case"https://atomicdata.dev/datatypes/resourceArray":{if(!xt(s)){e="Not an array";break}s.map((r,o)=>{try{U.tryValidSubject(r)}catch{const a=new Error("Invalid URL");throw a.index=o,a}});break}case"https://atomicdata.dev/datatypes/integer":{if(!Vt(s)){e="Not a number";break}s%1!==0&&(e="Not an integer");break}case"https://atomicdata.dev/datatypes/date":{if(!Y(s)){e="Not a string";break}s.match(Us)===null&&(e="Not a date string: YYYY-MM-DD");break}}if(e!==null)throw new Error(e)};function xt(s){return Object.prototype.toString.call(s)==="[object Array]"}function Y(s){return typeof s=="string"}function Vt(s){return typeof s=="number"}const _s={"https://atomicdata.dev/datatypes/string":"String","https://atomicdata.dev/datatypes/slug":"Slug","https://atomicdata.dev/datatypes/markdown":"Markdown","https://atomicdata.dev/datatypes/integer":"Integer","https://atomicdata.dev/datatypes/float":"Float","https://atomicdata.dev/datatypes/boolean":"Boolean","https://atomicdata.dev/datatypes/date":"Date","https://atomicdata.dev/datatypes/timestamp":"Timestamp","https://atomicdata.dev/datatypes/atomicURL":"Resource","https://atomicdata.dev/datatypes/resourceArray":"ResourceArray","unknown-datatype":"Unknown"};var Q=(s=>(s.Unauthorized="Unauthorized",s.NotFound="NotFound",s.Server="Server",s.Client="Client",s))(Q||{});function je(s){if(s instanceof C){if(s.type==="Unauthorized")return!0;if(s.message.includes("Unauthorized"))return!0}return!1}function Bs(s){return s instanceof C}class C extends Error{constructor(t,e="Client"){super(t),Object.setPrototypeOf(this,C.prototype),this.type=e,this.message=t;try{const o=JSON.parse(t)[A.properties.description];o&&(this.message=o)}catch{}this.message||(this.message=this.createMessage())}static fromResource(t){return new C(t.get(A.properties.description).toString())}createMessage(){switch(this.type){case"Unauthorized":return"You don't have the rights to do this.";case"NotFound":return"404 Not found.";case"Server":return"500 Unknown server error.";default:return"Unknown error."}}}class Pe{constructor(){this.subscriptions=new Map}register(t,e){const r=this.subscriptions.get(t)??new Set;return r.add(e),this.subscriptions.set(t,r),()=>{r.delete(e)}}async emit(t,...e){if(!this.subscriptions.has(t))return;const r=this.subscriptions.get(t),o=async i=>i(...e);r&&await Promise.allSettled([...r].map(i=>o(i)))}hasSubscriptions(t){return this.subscriptions.has(t)}}class Ct{constructor(t,e,r,o=!1){this.__internalObject=this,this.pages=new Map,this._totalMembers=0,this.store=t,this.server=e,this.params=r,o||(this._waitForReady=this.fetchPage(0)),this.clearPages=this.clearPages.bind(this)}get property(){return this.params.property}get value(){return this.params.value}get sortBy(){return this.params.sort_by}get sortDesc(){return!!this.params.sort_desc}get pageSize(){return parseInt(this.params.page_size,10)}get totalMembers(){return this._totalMembers}get totalPages(){return Math.ceil(this.totalMembers/this.pageSize)}waitForReady(){return this._waitForReady}async getMemberWithIndex(t){if(t>=this.totalMembers)throw new Error("Index out of bounds");const e=Math.floor(t/this.pageSize);return this.pages.has(e)||(this._waitForReady=this.fetchPage(e),await this._waitForReady),this.pages.get(e).getSubjects(Rt.properties.members)[t%this.pageSize]}clearPages(){this.pages=new Map}async refresh(){return this.clearPages(),this._waitForReady=this.fetchPage(0),this._waitForReady}clone(){const t=new Ct(this.store,this.server,this.params);return t._totalMembers=this._totalMembers,t._waitForReady=this._waitForReady,t.pages=this.pages,t}async*[Symbol.asyncIterator](){await this.waitForReady();for(let t=0;t<this.totalMembers;t++){const e=await this.getMemberWithIndex(t);e!==void 0&&(yield e)}}async getAllMembers(){const t=[];for await(const e of this)t.push(e);return t}async getMembersOnPage(t){return this.pages.has(t)||await this.fetchPage(t),(this.pages.get(t).props.members??[]).filter(r=>r!==void 0)}buildSubject(t){const e=new URL(`${this.server}/query`);for(const[r,o]of Object.entries(this.params))e.searchParams.set(r,o);return e.searchParams.set("current_page",`${t}`),e.toString()}async fetchPage(t){const e=this.buildSubject(t),r=await this.store.fetchResourceFromServer(e);if(!r)throw new Error("Invalid collection: resource does not exist");if(r.error)throw new Error(`Invalid collection: resource has error: ${r.error}`);this.pages.set(t,r);const o=r.props.totalMembers;if(!Vt(o))throw new Error("Invalid collection: total-members is not a number");this._totalMembers=o}}function Os(s){return s.__internalObject!==s&&console.warn("Attempted to proxy a proxy for a collection"),new Proxy(s.__internalObject,{})}class Ne{constructor(t,e){this.params={page_size:"30"},this.store=t,this.server=e??new URL(t.getServerUrl()).origin}setProperty(t){return this.params.property=t,this}setValue(t){return this.params.value=t,this}setSortBy(t){return this.params.sort_by=t,this}setSortDesc(t){return this.params.sort_desc=t,this}setPageSize(t){return this.params.page_size=`${t}`,this}build(){return new Ct(this.store,this.server,this.params)}async buildAndFetch(){const t=this.build();return await t.waitForReady(),t}}const Ue={agent:"https://atomicdata.dev/classes/Agent",chatRoom:"https://atomicdata.dev/classes/ChatRoom",collection:"https://atomicdata.dev/classes/Collection",commit:"https://atomicdata.dev/classes/Commit",class:"https://atomicdata.dev/classes/Class",document:"https://atomicdata.dev/classes/Document",bookmark:"https://atomicdata.dev/class/Bookmark",elements:{paragraph:"https://atomicdata.dev/classes/elements/Paragraph"},error:"https://atomicdata.dev/classes/Error",property:"https://atomicdata.dev/classes/Property",datatype:"https://atomicdata.dev/classes/Datatype",endpoint:"https://atomicdata.dev/classes/Endpoint",drive:"https://atomicdata.dev/classes/Drive",redirect:"https://atomicdata.dev/classes/Redirect",invite:"https://atomicdata.dev/classes/Invite",file:"https://atomicdata.dev/classes/File",message:"https://atomicdata.dev/classes/Message",importer:"https://atomicdata.dev/classes/Importer",folder:"https://atomicdata.dev/classes/Folder",article:"https://atomicdata.dev/classes/Article",displayStyle:"https://atomicdata.dev/class/DisplayStyle",displayStyles:{grid:"https://atomicdata.dev/display-style/grid",list:"https://atomicdata.dev/display-style/list"},dateFormat:"https://atomicdata.dev/classes/DateFormat",numberFormat:"https://atomicdata.dev/classes/NumberFormat",constraintProperties:{rangeProperty:"https://atomicdata.dev/classes/RangeProperty",floatRangeProperty:"https://atomicdata.dev/classes/FloatRangeProperty",formattedNumber:"https://atomicdata.dev/classes/FormattedNumber",selectProperty:"https://atomicdata.dev/classes/SelectProperty",formattedDate:"https://atomicdata.dev/classes/FormattedDate"},table:"https://atomicdata.dev/classes/Table",tag:"https://atomicdata.dev/classes/Tag",ontology:"https://atomicdata.dev/class/ontology"},N={allowsOnly:"https://atomicdata.dev/properties/allowsOnly",getAll:"https://atomicdata.dev/properties/?page_size=999",children:"https://atomicdata.dev/properties/children",classType:"https://atomicdata.dev/properties/classtype",createdBy:"https://atomicdata.dev/properties/createdBy",datatype:"https://atomicdata.dev/properties/datatype",description:"https://atomicdata.dev/properties/description",drives:"https://atomicdata.dev/properties/drives",incomplete:"https://atomicdata.dev/properties/incomplete",isA:"https://atomicdata.dev/properties/isA",isDynamic:"https://atomicdata.dev/properties/isDynamic",name:"https://atomicdata.dev/properties/name",parent:"https://atomicdata.dev/properties/parent",paymentPointer:"https://atomicdata.dev/properties/paymentPointer",read:"https://atomicdata.dev/properties/read",recommends:"https://atomicdata.dev/properties/recommends",requires:"https://atomicdata.dev/properties/requires",shortname:"https://atomicdata.dev/properties/shortname",subResources:"https://atomicdata.dev/properties/subresources",write:"https://atomicdata.dev/properties/write",displayStyle:"https://atomicdata.dev/property/display-style",publishedAt:"https://atomicdata.dev/properties/published-at",agent:{publicKey:"https://atomicdata.dev/properties/publicKey"},collection:{members:"https://atomicdata.dev/properties/collection/members",currentPage:"https://atomicdata.dev/properties/collection/currentPage",pageSize:"https://atomicdata.dev/properties/collection/pageSize",property:"https://atomicdata.dev/properties/collection/property",totalMembers:"https://atomicdata.dev/properties/collection/totalMembers",totalPages:"https://atomicdata.dev/properties/collection/totalPages",value:"https://atomicdata.dev/properties/collection/value"},commit:{subject:"https://atomicdata.dev/properties/subject",createdAt:"https://atomicdata.dev/properties/createdAt",lastCommit:"https://atomicdata.dev/properties/lastCommit",previousCommit:"https://atomicdata.dev/properties/previousCommit",signer:"https://atomicdata.dev/properties/signer",set:"https://atomicdata.dev/properties/set",push:"https://atomicdata.dev/properties/push",remove:"https://atomicdata.dev/properties/remove",destroy:"https://atomicdata.dev/properties/destroy",signature:"https://atomicdata.dev/properties/signature"},document:{elements:"https://atomicdata.dev/properties/documents/elements"},endpoint:{parameters:"https://atomicdata.dev/properties/endpoint/parameters",results:"https://atomicdata.dev/properties/endpoint/results"},search:{query:"https://atomicdata.dev/properties/search/query",limit:"https://atomicdata.dev/properties/search/limit",property:"https://atomicdata.dev/properties/search/property"},redirect:{destination:"https://atomicdata.dev/properties/destination",redirectAgent:"https://atomicdata.dev/properties/invite/redirectAgent"},invite:{agent:"https://atomicdata.dev/properties/invite/agent",publicKey:"https://atomicdata.dev/properties/invite/publicKey",target:"https://atomicdata.dev/properties/invite/target",usagesLeft:"https://atomicdata.dev/properties/invite/usagesLeft",users:"https://atomicdata.dev/properties/invite/users",write:"https://atomicdata.dev/properties/invite/write"},file:{filename:"https://atomicdata.dev/properties/filename",filesize:"https://atomicdata.dev/properties/filesize",downloadUrl:"https://atomicdata.dev/properties/downloadURL",mimetype:"https://atomicdata.dev/properties/mimetype",attachments:"https://atomicdata.dev/properties/attachments"},chatRoom:{messages:"https://atomicdata.dev/properties/messages",nextPage:"https://atomicdata.dev/properties/nextPage",replyTo:"https://atomicdata.dev/properties/replyTo"},bookmark:{url:"https://atomicdata.dev/property/url",preview:"https://atomicdata.dev/property/preview",imageUrl:"https://atomicdata.dev/properties/imageUrl"},constraints:{max:"https://atomicdata.dev/properties/max",min:"https://atomicdata.dev/properties/min",maxFloat:"https://atomicdata.dev/properties/maxFloat",minFloat:"https://atomicdata.dev/properties/minFloat",numberFormatting:"https://atomicdata.dev/properties/numberFormatting",decimalPlaces:"https://atomicdata.dev/properties/decimalPlaces",dateFormat:"https://atomicdata.dev/properties/dateFormat"},table:{tableColumnWidths:"https://atomicdata.dev/properties/tableColumnWidths"},ontology:{customNodePositioning:"https://atomicdata.dev/properties/custom-node-positioning"},color:"https://atomicdata.dev/properties/color",emoji:"https://atomicdata.dev/properties/emoji",classes:"https://atomicdata.dev/properties/classes",properties:"https://atomicdata.dev/properties/properties",instances:"https://atomicdata.dev/properties/instances"},_e={atomicUrl:"https://atomicdata.dev/datatypes/atomicURL",boolean:"https://atomicdata.dev/datatypes/boolean",date:"https://atomicdata.dev/datatypes/date",float:"https://atomicdata.dev/datatypes/float",integer:"https://atomicdata.dev/datatypes/integer",markdown:"https://atomicdata.dev/datatypes/markdown",resourceArray:"https://atomicdata.dev/datatypes/resourceArray",slug:"https://atomicdata.dev/datatypes/slug",string:"https://atomicdata.dev/datatypes/string",timestamp:"https://atomicdata.dev/datatypes/timestamp"},Gt={publicAgent:"https://atomicdata.dev/agents/publicAgent",displayStyleGrid:"https://atomicdata.dev/agents/publicAgent",numberFormats:{number:"https://atomicdata.dev/classes/NumberFormat/number",percentage:"https://atomicdata.dev/classes/NumberFormat/Percentage",currency:"https://atomicdata.dev/ontology/data-browser/number-format/vAikhI3z"},dateFormats:{localNumeric:"https://atomicdata.dev/classes/DateFormat/localNumeric",localLong:"https://atomicdata.dev/classes/DateFormat/localLong",localRelative:"https://atomicdata.dev/classes/DateFormat/localRelative"}},Jt={import:"/import"},b={properties:N,endpoints:Jt,classes:Ue,datatypes:_e,instances:Gt};function yt(s){if(s===void 0)throw new Error(`Not an array: ${s}, is ${typeof s}`);if(s.constructor===Array)return s;throw new Error(`Not an array: ${s}, is a ${typeof s}`)}function ks(s){if(typeof s!="boolean")throw new Error(`Not a boolean: ${s}, is a ${typeof s}`);return s}function Ts(s){if(typeof s=="number"){const t=new Date(0);return t.setUTCMilliseconds(s),t}if(typeof s=="string")return new Date(s.toString());throw new Error(`Cannot be converted into Date: ${s}, is a ${typeof s}`)}function Fs(s){if(typeof s!="number")throw new Error(`Not a number: ${s}, is a ${typeof s}`);return s}function Is(s){return(s==null?void 0:s.toString())??"undefined"}function Ms(s){if(typeof s=="string")return s;if(s instanceof Date)throw new Error(`Not a resource: ${s}, is a Date`);if((s==null?void 0:s.constructor)===Array)throw new Error(`Not a resource: ${s}, is an Array`);if(typeof s=="object"){const t=new G,[e]=t.parseObject(s,"nested-resource");return e}throw typeof s!="object"?new Error(`Not a resource: ${s}, is a ${typeof s}`):new Error(`Not a resource: ${s}, is a ${typeof s}`)}const V="unknown-subject";var Be=(s=>(s.LocalChange="local-change",s))(Be||{});class I{constructor(t,e){if(this.loading=!1,this.appliedCommitSignatures=new Set,this.__internalObject=this,this.propvals=new Map,this.hasQueue=!1,this.eventManager=new Pe,typeof t!="string")throw new Error("Invalid subject given to resource, must be a string, found "+typeof t);this.new=!!e,this._subject=t,this.commitBuilder=new tt(t)}get subject(){return this._subject}get title(){return this.get(A.properties.name)??this.get(A.properties.shortname)??this.get(nt.properties.filename)??this.subject}get props(){const t={};for(const e of this.propvals.keys()){const r=ge(e);r&&(t[r]=this.get(e))}return t}get store(){if(!this._store)throw console.error(`Resource ${this.title} has no store`),new Error("Resource has no store");return this._store}on(t,e){return this.eventManager.register(t,e)}setStore(t){this._store=t}equals(t){return this===t.__internalObject?!0:!(this.subject!==t.subject||this.new!==t.new||this.error!==t.error||this.loading!==t.loading||JSON.stringify(Array.from(this.propvals.entries()))!==JSON.stringify(Array.from(t.propvals.entries()))||JSON.stringify(Array.from(this.commitBuilder.set.entries()))!==JSON.stringify(Array.from(t.commitBuilder.set.entries())))}async canWrite(t,e){const r=this.get(N.write);if(!t)return[!1,"No agent given"];if(r&&yt(r).includes(t))return[!0,void 0];if(r&&yt(r).includes(Gt.publicAgent))return[!0,void 0];const o=this.get(N.parent);return o?o===t?[!0,void 0]:e===o?(console.warn("Circular parent",e),[!0,`Circular parent in ${this.subject}`]):await(await this.store.getResource(o)).canWrite(t,this.subject):[!1,`No write right or parent in ${this.subject}`]}clone(){const t=new I(this.subject);return t.propvals=structuredClone(this.propvals),t.loading=this.loading,t.new=this.new,t.error=structuredClone(this.error),t.commitError=this.commitError,t.commitBuilder=this.commitBuilder.clone(),t.appliedCommitSignatures=this.appliedCommitSignatures,t}isReady(){return!this.loading&&this.error===void 0}get(t){return this.propvals.get(t)}getSubjects(t){return this.getArray(t).map(e=>typeof e=="string"?e:e["@id"])}getArray(t){const e=this.propvals.get(t)??[];return yt(e)}getClasses(){return this.getSubjects(A.properties.isA)}hasClasses(...t){return t.every(e=>this.getClasses().includes(e))}matchClass(t,e){for(const[r,o]of Object.entries(t))if(this.hasClasses(r))return o;return e}removeClasses(...t){this.set(A.properties.isA,this.getClasses().filter(e=>!t.includes(e)),!1)}addClasses(...t){const e=new Set([...this.getClasses(),...t]);return this.set(A.properties.isA,Array.from(e))}hasUnsavedChanges(){return this.commitBuilder.hasUnsavedChanges()}getCommitsCollectionSubject(){const t=new URL(this.subject);return t.pathname="/commits",t.searchParams.append("property",b.properties.commit.subject),t.searchParams.append("value",this.subject),t.searchParams.append("sort_by",b.properties.commit.createdAt),t.searchParams.append("include_nested","true"),t.searchParams.append("page_size","9999"),t.toString()}async getChildrenCollection(t=100){return await new Ne(this.store).setPageSize(t).setProperty(A.properties.parent).setValue(this.subject).buildAndFetch()}async getHistory(t){const r=(await this.store.fetchResourceFromServer(this.getCommitsCollectionSubject())).get(N.collection.members),o=[];let i=new I(this.subject);for(let a=0;a<r.length;a++){const n=await this.store.getResource(r[a]),c=Te(n),d=Xt(i.clone(),c);o.push({commit:c,resource:d}),i=d,t&&a%30===0&&(t(Math.round(a/r.length*100)),await Ds())}return o}async setVersion(t){const e=t.resource.getPropVals();for(const r of this.propvals.keys())e.has(r)||this.remove(r);for(const[r,o]of e.entries())await this.set(r,o);await this.save()}getSubject(){return this.subject}getSubjectNoParams(){const t=new URL(this.subject);return t.origin+t.pathname}getPropVals(){return this.propvals}async getRights(){const t=[];this.getSubjects(N.write).forEach(i=>{t.push({for:i,type:"write",setIn:this.subject})}),this.getSubjects(N.read).forEach(i=>{t.push({for:i,type:"read",setIn:this.subject})});const o=this.get(N.parent);if(o){if(o===this.subject)return console.warn("Circular parent",o),t;const a=await(await this.store.getResource(o)).getRights();t.push(...a)}return t}isUnauthorized(){return!!this.error&&je(this.error)}async destroy(t){if(this.new){this.store.removeResource(this.subject);return}const e=new tt(this.subject);if(e.setDestroy(!0),t===void 0&&(t=this.store.getAgent()),(t==null?void 0:t.subject)===void 0)throw new Error("No agent has been set or passed, you cannot delete this.");const r=await e.sign(t.privateKey,t.subject),o=new URL(this.subject).origin+"/commit";await this.store.postCommit(r,o),this.store.removeResource(this.subject)}pushPropVal(t,e,r){this.push(t,e,r)}push(t,e,r){const o=this.get(t)??[];r&&(e=e.filter(i=>!o.includes(i)).filter(i=>{var a;return!((a=this.commitBuilder.push[t])!=null&&a.includes(i))}).filter((i,a,n)=>n.indexOf(i)===a)),this.commitBuilder.addPushAction(t,...e),this.propvals.set(t,[...o,...e])}removePropVal(t){this.remove(t)}remove(t){this.propvals.delete(t),this.commitBuilder.addRemoveAction(t)}removePropValLocally(t){this.propvals.delete(t)}async save(t){var d,u;if(!this.commitBuilder.hasUnsavedChanges()){console.warn(`No changes to ${this.subject}, not saving`);return}const e=this.store.getAgent()??t;if(!e)throw new Error("No agent has been set or passed, you cannot save.");if(this.hasQueue)return;if(this.isParentNew()){this.store.batchResource(this.subject);return}if(this.inProgressCommit)return this.hasQueue=!0,await this.inProgressCommit,this.hasQueue=!1,this.inProgressCommit=void 0,this.save(t);const r=(d=this.get(N.commit.lastCommit))==null?void 0:d.toString();r&&this.commitBuilder.setPreviousCommit(r);const o=this.new;let i=()=>{};this.inProgressCommit=new Promise(h=>{i=()=>{h()}});const a=this.commitBuilder.clone();this.commitBuilder=new tt(this.subject);const n=await a.sign(e.privateKey,e.subject);this.appliedCommitSignatures.add(n.signature),this.loading=!1,this.new=!1;const c=new URL(this.subject).origin+"/commit";try{this.commitError=void 0,this.store.addResources(this,{skipCommitCompare:!0});const h=await this.store.postCommit(n,c);return this.setUnsafe(N.commit.lastCommit,h.id),this.store.notifyResourceSaved(this),o&&(this.store.subscribeWebSocket(this.subject),await this.store.saveBatchForParent(this.subject)),i(),h.id}catch(h){if(h.message.includes("previousCommit")){console.warn("previousCommit missing or mismatch, retrying...");const f=(u=(await this.store.fetchResourceFromServer(this.subject)).get(N.commit.lastCommit))==null?void 0:u.toString();return f&&this.setUnsafe(N.commit.lastCommit,f),i(),await this.save(e)}throw this.commitBuilder=a,this.commitError=h,this.store.addResources(this,{skipCommitCompare:!0}),i(),h}}async set(t,e,r=!0){if(this.store.isOffline()&&r&&(console.warn("Offline, not validating"),r=!1),r){const o=await this.store.getProperty(t);try{Ce(e,o.datatype)}catch(i){throw i instanceof Error&&(i.message=`Error validating ${o.shortname} with value ${e} for ${this.subject}: ${i.message}`),i}}if(e===void 0){this.remove(t),this.eventManager.emit("local-change",t,e);return}this.propvals.set(t,e),this.commitBuilder.addSetAction(t,e),this.eventManager.emit("local-change",t,e)}setUnsafe(t,e){this.propvals.set(t,e)}setError(t){this.error=t}setSubject(t){U.tryValidSubject(t),this.commitBuilder.setSubject(t),this._subject=t}async refresh(){await this.store.fetchResourceFromServer(this.subject,{noWebSocket:!0})}isParentNew(){const t=this.propvals.get(A.properties.parent);return t?this.store.getResourceLoading(t).new:!1}}var Oe=(s=>(s.READ="read",s.WRITE="write",s))(Oe||{});function $s(s){return s.__internalObject!==s&&console.warn("Attempted to proxy a proxy for "+s.subject),new Proxy(s.__internalObject,{})}const Ds=()=>new Promise(s=>setTimeout(s));class G{constructor(){this.parsedResources=[]}parseObject(t,e){return this.parsedResources=[],[this.parseJsonADResource(t,e),[...this.parsedResources]]}parseArray(t){return this.parsedResources=[],[this.parseJsonADArray(t),[...this.parsedResources]]}parseValue(t,e){return this.parsedResources=[],[this.parseJsonAdResourceValue(t,e),[...this.parsedResources]]}parseJsonADResource(t,e=V){const r=new I(e);this.parsedResources.push(r);try{for(const[o,i]of Object.entries(t)){if(o==="@id"){if(typeof i!="string")throw new Error("'@id' field must be a string");if(r.subject!=="undefined"&&r.subject!==V&&i!==r.subject)throw new Error(`Resource has wrong subject in @id. Received subject was ${i}, expected ${r.subject}.`);r.setSubject(i);continue}try{if(xt(i)){const a=i.map(n=>this.parseJsonAdResourceValue(n,o));r.setUnsafe(o,a)}else if(typeof i=="string")r.setUnsafe(o,i);else if(typeof i=="number")r.setUnsafe(o,i);else if(typeof i=="boolean")r.setUnsafe(o,i);else{const a=this.parseJsonAdResourceValue(i,o);r.setUnsafe(o,a)}}catch(a){const c=`${`Failed creating value ${i} for key ${o} in resource ${r.subject}`}. ${a.message}`;throw new Error(c)}}r.loading=!1,r.hasClasses(nt.classes.error)&&(r.error=C.fromResource(r))}catch(o){throw o.message="Failed parsing JSON "+o.message,r.setError(o),r.loading=!1,o}return r}parseJsonAdResourceValue(t,e){if(typeof t=="string")return t;if((t==null?void 0:t.constructor)==={}.constructor)if(Object.keys(t).includes("@id")){const r=t["@id"];return this.parseJsonADResource(t),r}else return t;throw new Error(`Value ${t} in ${e} not a string or a nested Resource`)}parseJsonADArray(t){const e=[];try{for(const r of t){const o=this.parseJsonADResource(r);e.push(o)}}catch(r){throw r.message="Failed parsing JSON "+r.message,r}return e}}pt.sha512=s=>Promise.resolve(js(s));function jt(){return Math.round(new Date().getTime())}class tt{constructor(t,e={}){this._subject=U.removeQueryParamsFromURL(t),this._set=e.set??new Map,this._push=e.push??new Map,this._remove=e.remove??new Set,this._destroy=e.destroy,this._previousCommit=e.previousCommit}get subject(){return this._subject}get set(){return this._set}get push(){return this._push}get remove(){return this._remove}get destroy(){return this._destroy}get previousCommit(){return this._previousCommit}addSetAction(t,e){return this.removeRemoveAction(t),this._set.set(t,e),this}addPushAction(t,...e){const r=this._push.get(t)??new Set;for(const o of e)r.add(o);return this._push.set(t,r),this}addRemoveAction(t){return this._set.delete(t),this._push.delete(t),this._remove.add(t),this}removeRemoveAction(t){return this._remove.delete(t),this}setDestroy(t){return this._destroy=t,this}setPreviousCommit(t){return this._previousCommit=t,this}setSubject(t){return this._subject=t,this}async sign(t,e){return await this.signAt(e,t,jt())}hasUnsavedChanges(){return this.set.size>0||this.push.size>0||this.destroy||this.remove.size>0}clone(){const t={set:this.set,push:this.push,remove:this.remove,destroy:this.destroy,previousCommit:this.previousCommit};return new tt(this.subject,structuredClone(t))}toPlainObject(){return{subject:this.subject,set:Object.fromEntries(this.set.entries()),push:Object.fromEntries(Array.from(this.push.entries()).map(([t,e])=>[t,Array.from(e)])),remove:Array.from(this.remove),destroy:this.destroy,previousCommit:this.previousCommit}}async signAt(t,e,r){if(t===void 0)throw new Error("No agent passed to sign commit");if(!this.hasUnsavedChanges())throw new Error(`No changes to commit in ${this.subject}`);const o={...this.clone().toPlainObject(),createdAt:r,signer:t},i=qt({...o}),a=await Zt(i,e);return{...o,signature:a}}}function L(s,t,e){t in s&&t!==e&&(Object.defineProperty(s,e,Object.getOwnPropertyDescriptor(s,t)),delete s[t])}function qt(s){return s.remove&&Object.keys(s.remove).length===0&&delete s.remove,s.set&&Object.keys(s.set).length===0&&delete s.set,s.push&&Object.keys(s.push).length===0&&delete s.push,s.destroy===!1&&delete s.destroy,L(s,"createdAt",b.properties.commit.createdAt),L(s,"subject",b.properties.commit.subject),L(s,"set",b.properties.commit.set),L(s,"push",b.properties.commit.push),L(s,"signer",b.properties.commit.signer),L(s,"signature",b.properties.commit.signature),L(s,"remove",b.properties.commit.remove),L(s,"destroy",b.properties.commit.destroy),L(s,"previousCommit",b.properties.commit.previousCommit),s[b.properties.isA]=[b.classes.commit],ps(s)}const Zt=async(s,t)=>{const e=Ae(t),r=new Uint8Array(e),i=new TextEncoder().encode(s),a=await as(i,r);return St(a)},ke=async s=>{const t=Ae(s),e=new Uint8Array(t),r=await Re(e);return St(r)};async function Ls(){const s=pt.randomPrivateKey(),t=await Re(s),e=St(s);return{publicKey:St(t),privateKey:e}}function Te(s){return{id:s.getSubject(),subject:s.get(b.properties.commit.subject),set:s.get(b.properties.commit.set),push:s.get(b.properties.commit.push),signer:s.get(b.properties.commit.signer),createdAt:s.get(b.properties.commit.createdAt),remove:s.get(b.properties.commit.remove),destroy:s.get(b.properties.commit.destroy),signature:s.get(b.properties.commit.signature)}}function Yt(s){try{const t=JSON.parse(s);if(typeof t!="object")throw new Error("Commit is not an object");const e=t[b.properties.commit.subject],r=t[b.properties.commit.set],o=t[b.properties.commit.push],i=t[b.properties.commit.signer],a=t[b.properties.commit.createdAt],n=t[b.properties.commit.remove],c=t[b.properties.commit.destroy],d=t[b.properties.commit.signature],u=t["@id"],h=t[b.properties.commit.previousCommit];if(!d)throw new Error("Commit has no signature");return{subject:e,set:r,push:o,signer:i,createdAt:a,remove:n,destroy:c,signature:d,id:u,previousCommit:h}}catch(t){throw new Error(`Could not parse commit: ${t}, Commit: ${s}`)}}function Xt(s,t){const{set:e,remove:r,push:o}=t;return e&&Ws(e,s),r&&zs(r,s),o&&Hs(o,s),s}function Fe(s,t){const e=Yt(s),{subject:r,id:o,destroy:i,signature:a}=e;let n=t.resources.get(r);if(!n)n=new I(r);else if(n.appliedCommitSignatures.has(a))return;if(n=Xt(n,e),o&&n.setUnsafe(N.commit.lastCommit,o),i){t.removeResource(r);return}else n.appliedCommitSignatures.add(a),t.addResources(n,{skipCommitCompare:!0})}function Ws(s,t,e){const r=new G,o=[];for(const[i,a]of Object.entries(s)){let n=a;if((a==null?void 0:a.constructor)==={}.constructor){const[c,d]=r.parseValue(a,i);n=c,o.push(...d)}xt(a)&&(n=a.map(c=>{const[d,u]=r.parseValue(c,i);return o.push(...u),d})),t.setUnsafe(i,n)}}function zs(s,t){for(const e of s)t.removePropValLocally(e)}function Hs(s,t,e){const r=new G,o=[];for(const[i,a]of Object.entries(s)){const n=t.get(i)||[],d=a.map(h=>{const[l,f]=r.parseValue(h,i);return o.push(...f),l}),u=[...n,...d];t.setUnsafe(i,u)}}async function Qt(s,t){const e=jt();if(!t.subject)throw new Error("Agent has no subject, cannot authenticate");return{"https://atomicdata.dev/properties/auth/agent":t.subject,"https://atomicdata.dev/properties/auth/requestedSubject":s,"https://atomicdata.dev/properties/auth/publicKey":await t.getPublicKey(),"https://atomicdata.dev/properties/auth/timestamp":e,"https://atomicdata.dev/properties/auth/signature":await te(s,t,e)}}async function te(s,t,e){const r=`${s} ${e}`;return await Zt(r,t.privateKey)}function Ks(s,t){var e;return!s.startsWith("http://localhost")&&((e=t==null?void 0:t.subject)==null?void 0:e.startsWith("http://localhost"))}async function $t(s,t,e){const r=jt();return t!=null&&t.subject&&!Ks(s,t)&&(e["x-atomic-public-key"]=await t.getPublicKey(),e["x-atomic-signature"]=await te(s,t,r),e["x-atomic-timestamp"]=r,e["x-atomic-agent"]=t==null?void 0:t.subject),e}const Vs=24*60*60*1e3,Gs=(s,t,e,r=Vs)=>{const o=new Date(Date.now()+r).toUTCString(),i=encodeURIComponent(t),a=new URL(e).hostname,n=`${s}=${i};Expires=${o};Domain=${a};SameSite=Lax;path=/`;document.cookie=n},Ie="atomic_session",ee=(s,t)=>{Qt(s,t).then(e=>{Gs(Ie,btoa(JSON.stringify(e)),s)})},Me=()=>{const s=document.cookie.match(/^(.*;)?\s*atomic_session\s*=\s*[^;]+(.*)?$/);return s?s.length>0:!1},$e=()=>{document.cookie=`${Ie}=;Max-Age=-99999999`},Js=s=>"blob"in s&&"name"in s,qs="application/ad+json";class U{constructor(t){t&&this.setFetch(t)}static tryValidSubject(t){try{new URL(t)}catch(e){throw new Error(`Not a valid URL: ${t}. ${e}`)}}static isValidSubject(t){if(typeof t!="string")return!1;try{return U.tryValidSubject(t),!0}catch{return!1}}static removeQueryParamsFromURL(t){return t==null?void 0:t.split("?")[0]}setFetch(t){this.__fetchOverride=t.bind(globalThis)}async fetchResourceHTTP(t,e={}){const{signInfo:r,from:o,body:i,method:a}=e;let n=[];const c=new G;let d=new I(t);try{U.tryValidSubject(t);const u={};u.Accept=qs,r&&(gt()&&t.startsWith(window.location.origin)?Me()||ee(r.serverURL,r.agent):await $t(t,r.agent,u));let h=t;if(o!==void 0){const m=new URL(`${o}/path`);m.searchParams.set("path",t),h=m.href}const l=await this.fetch(h,{headers:u,method:a??"GET",body:i}),f=await l.text();if(l.status===200)try{const m=JSON.parse(f);if(e.noNested)d=m;else{const[y,S]=c.parseObject(m,t);d=y,n.push(...S)}}catch(m){throw new C(`Could not parse JSON from fetching ${t}. Is it an Atomic Data resource? Error message: ${m.message}`)}else throw l.status===401?new C(f,Q.Unauthorized):l.status===500?new C(f,Q.Server):l.status===404?new C(f,Q.NotFound):new C(f)}catch(u){d.setError(u),n=[d],console.error(t,u)}return d.loading=!1,{resource:d,createdResources:n}}async postCommit(t,e){const r=qt({...t}),o=new Headers;o.set("Content-Type","application/ad+json");let i;try{i=await this.fetch(e,{headers:o,method:"POST",body:r})}catch(n){throw new C(`Posting Commit to ${e} failed: ${n}`)}const a=await i.text();if(i.status!==200)throw new C(a,Q.Server);return Yt(a)}async uploadFiles(t,e,r,o){const i=new G,a=new FormData;t.map(m=>{Js(m)?a.append("assets",m.blob,m.name):a.append("assets",m,m.name)});const n=new URL(`${e}/upload`);n.searchParams.set("parent",o);const c=await $t(n.toString(),r,{}),d={method:"POST",body:a,headers:c},u=await this.fetch(n.toString(),d),h=await u.text();if(u.status!==200)throw Error(h);const l=JSON.parse(h),[f]=i.parseArray(l);return f}fetch(...t){return this.__fetchOverride?this.__fetchOverride(...t):fetch(...t)}}class se{constructor(t,e){if(e&&U.tryValidSubject(e),!t)throw new C("Agent requires a private key");this.client=new U,this.subject=e,this.privateKey=t}static fromSecret(t){const e=atob(t),r=JSON.parse(e),{privateKey:o,subject:i}=r;return new se(o,i)}async getPublicKey(){if(!this.publicKey){const t=await ke(this.privateKey);this.publicKey=t}return this.publicKey}buildSecret(){const t=JSON.stringify(this);return btoa(t)}async verifyPublicKeyWithServer(){var r;if(!this.subject)throw new C("Agent has no subject");const{resource:t}=await this.client.fetchResourceHTTP(this.subject);if(t.error)throw new Error(`Could not fetch agent, and could therefore not check validity of public key. ${t.error}`);if(((r=t.get(A.properties.publicKey))==null?void 0:r.toString())!==await this.getPublicKey())throw new Error("Fetched publickey does not match current one - is the private key correct?")}}const De=s=>{const t=new URL(s);return t.pathname="search",t},Zs=["+","^","`",":","{","}",'"',"[","]","(",")","!","\\","*"," ","."];function Le(s){return s.replace(new RegExp(`([${Zs.join("\\")}])`,"g"),"\\$1")}function Ys(s){return Object.entries(s).map(([t,e])=>e&&`${Le(t)}:"${e}"`).join(" AND ")}function We(s,t,e={}){const{include:r=!1,limit:o=30,parents:i,filters:a}=e,n=De(s),c=a&&Object.keys(a).length>0&&Object.values(a).filter(d=>d&&d.length>0).length>0;return t&&n.searchParams.set("q",t),r&&n.searchParams.set("include",r.toString()),o&&n.searchParams.set("limit",o.toString()),c&&n.searchParams.set("filters",Ys(a)),i&&(Array.isArray(i)?n.searchParams.append("parents",i.join(",")):n.searchParams.append("parents",i)),n.toString()}function Xs(s){const t=De(s.getServerUrl()).toString(),e=s.clientSideQuery(r=>r.subject!==t&&r.subject.startsWith(t));for(const r of e)s.removeResource(r.subject)}function Ft(s){if(!re(s))throw new Error("Parameter was not an error")}function re(s){return!!s&&typeof s=="object"&&Qs(s)==="[object Error]"||s instanceof Error}function Qs(s){return Object.prototype.toString.call(s)}const tr="Layerr";let er=tr;function sr(){return er}function rr(s){let t,e="";if(s.length===0)t={};else if(re(s[0]))t={cause:s[0]},e=s.slice(1).join(" ")||"";else if(s[0]&&typeof s[0]=="object")t=Object.assign({},s[0]),e=s.slice(1).join(" ")||"";else if(typeof s[0]=="string")t={},e=e=s.join(" ")||"";else throw new Error("Invalid arguments passed to Layerr");return{options:t,shortMessage:e}}class F extends Error{constructor(t,e){const r=[...arguments],{options:o,shortMessage:i}=rr(r);let a=i;if(o.cause&&(a=`${a}: ${o.cause.message}`),super(a),this.message=a,o.name&&typeof o.name=="string"?this.name=o.name:this.name=sr(),o.cause&&Object.defineProperty(this,"_cause",{value:o.cause}),Object.defineProperty(this,"_info",{value:{}}),o.info&&typeof o.info=="object"&&Object.assign(this._info,o.info),Error.captureStackTrace){const n=o.constructorOpt||this.constructor;Error.captureStackTrace(this,n)}}static cause(t){return Ft(t),t._cause&&re(t._cause)?t._cause:null}static fullStack(t){Ft(t);const e=F.cause(t);return e?`${t.stack}
caused by: ${F.fullStack(e)}`:t.stack??""}static info(t){Ft(t);const e={},r=F.cause(t);return r&&Object.assign(e,F.info(r)),t._info&&Object.assign(e,t._info),e}toString(){let t=this.name||this.constructor.name||this.constructor.prototype.name;return this.message&&(t=`${t}: ${this.message}`),t}}const ze="0123456789ABCDEFGHJKMNPQRSTVWXYZ",it=32,ue=0xffffffffffff,or=10,ir=16,rt=Object.freeze({source:"ulid"});function ar(s){const t=nr(),e=t&&(t.crypto||t.msCrypto)||null;if(typeof(e==null?void 0:e.getRandomValues)=="function")return()=>{const r=new Uint8Array(1);return e.getRandomValues(r),r[0]/255};if(typeof(e==null?void 0:e.randomBytes)=="function")return()=>e.randomBytes(1).readUInt8()/255;throw new F({info:{code:"PRNG_DETECT",...rt}},"Failed to find a reliable PRNG")}function nr(){return dr()?self:typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:null}function cr(s,t){let e="";for(;s>0;s--)e=hr(t)+e;return e}function pr(s,t){if(isNaN(s))throw new F({info:{code:"ENC_TIME_NAN",...rt}},`Time must be a number: ${s}`);if(s>ue)throw new F({info:{code:"ENC_TIME_SIZE_EXCEED",...rt}},`Cannot encode a time larger than ${ue}: ${s}`);if(s<0)throw new F({info:{code:"ENC_TIME_NEG",...rt}},`Time must be positive: ${s}`);if(Number.isInteger(s)===!1)throw new F({info:{code:"ENC_TIME_TYPE",...rt}},`Time must be an integer: ${s}`);let e,r="";for(let o=t;o>0;o--)e=s%it,r=ze.charAt(e)+r,s=(s-e)/it;return r}function dr(){return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope}function hr(s){let t=Math.floor(s()*it);return t===it&&(t=it-1),ze.charAt(t)}function ur(s,t){const e=ar(),r=isNaN(s)?Date.now():s;return pr(r,or)+cr(ir,e)}function lr(s){return s.toLowerCase().replace(/\s+/g,"-").replace(/-+/g,"-").replace(/[^\w-]+/g,"")}function le(s,t){const e=new URL(s);e.protocol==="http:"?e.protocol="ws":e.protocol="wss",e.pathname="/ws";const r=new WebSocket(e.toString());return r.onopen=o=>mr(t,r),r.onmessage=o=>fr(o,t),r.onerror=gr,r}function mr(s,t){Dt(t,s).then(()=>{for(const e of s.subscribers.keys())s.subscribeWebSocket(e)})}function fr(s,t){if(s.data.startsWith("COMMIT ")){const e=s.data.slice(7);Fe(e,t)}else if(s.data.startsWith("ERROR "))t.notifyError(s.data.slice(6));else if(s.data.startsWith("RESOURCE ")){const e=He(s);t.addResources(e)}else console.warn("Unknown websocket message:",s)}function gr(s){console.error("websocket error:",s)}function He(s){const t=s.data.slice(9),e=JSON.parse(t),r=new G,[o,i]=r.parseObject(e);return i}async function Dt(s,t,e=!1){var i;const r=t.getAgent();if(!r||!r.subject)return;if(!s.url.startsWith("ws://localhost")&&((i=r==null?void 0:r.subject)!=null&&i.startsWith("http://localhost"))){console.warn(`Can't authenticate localhost Agent over websocket with remote server ${s.url} because the server will nog be able to retrieve your Agent and verify your public key.`);return}const o=await Qt(s.url,r);s.send("AUTHENTICATE "+JSON.stringify(o)),e&&t.resources.forEach(a=>{(a.isUnauthorized()||a.loading)&&t.fetchResourceFromServer(a.subject)})}const me=5e3;async function yr(s,t){return new Promise((e,r)=>{s.addEventListener("message",function o(i){const a=setTimeout(()=>{s.removeEventListener("message",o),r(new Error(`Request for subject "${t}" timed out after ${me}ms.`))},me);i.data.startsWith("RESOURCE ")&&He(i).forEach(n=>{n.subject===t&&(clearTimeout(a),s.removeEventListener("message",o),e(n))})}),s.send("GET "+t)})}var Ke=(s=>(s.ResourceSaved="resource-saved",s.ResourceRemoved="resource-removed",s.ResourceManuallyCreated="resource-manually-created",s.AgentChanged="agent-changed",s.ServerURLChanged="server-url-changed",s.Error="error",s))(Ke||{});const It=()=>typeof WebSocket<"u";class br{constructor(t={}){this.batchedResources=new Map,this.eventManager=new Pe,this._resources=new Map,this.webSockets=new Map,this.subscribers=new Map,t.serverUrl&&this.setServerUrl(t.serverUrl),t.agent&&this.setAgent(t.agent),this.client=new U(this.injectedFetch),this.getAgent=this.getAgent.bind(this),this.setAgent=this.setAgent.bind(this)}get resources(){return this._resources}injectFetch(t){this.injectedFetch=t,this.client.setFetch(t)}addResources(t,e){for(const r of Array.isArray(t)?t:[t])this.addResource(r,e??{})}addResource(t,{skipCommitCompare:e}){if(t.setStore(this),t.get(A.properties.incomplete)){const r=this.resources.get(t.subject);if(r&&!r.loading)return}if(!e){const r=this.resources.get(t.subject);if(r&&!r.hasClasses(Rt.classes.collection)&&!r.loading&&!r.new&&r.get(vt.properties.lastCommit)===t.get(vt.properties.lastCommit))return}this.resources.set(t.subject,t.__internalObject),this.notify(t.__internalObject)}async newResource({subject:t,parent:e,isA:r,propVals:o,noParent:i}={}){const a=Array.isArray(r)?r:[r],n=t??this.createSubject(),c=this.getResourceLoading(n,{newResource:!0});if(a[0]&&await c.addClasses(...a),i||await c.set(A.properties.parent,e??this.serverUrl),o)for(const[d,u]of Object.entries(o))await c.set(d,u);return c}async search(t,e={}){const r=We(this.serverUrl,t,e);return(await this.fetchResourceFromServer(r,{noWebSocket:!0})).get(nt.properties.results)??[]}async checkSubjectTaken(t){var r;const e=this.resources.get(t);if(e!=null&&e.isReady()&&!(e!=null&&e.new))return!0;try{const o=this.agent?{agent:this.agent,serverURL:this.getServerUrl()}:void 0,{createdResources:i}=await this.client.fetchResourceHTTP(t,{method:"GET",signInfo:o});if((r=i.find(a=>a.subject===t))!=null&&r.isReady())return!0}catch{}return!1}async buildUniqueSubjectFromParts(t,e){const r=t.map(i=>lr(i)).join("/"),o=e??this.getServerUrl();return this.findAvailableSubject(r,o)}createSubject(t){return t?`${t}/${this.randomPart()}`:new URL(`/${this.randomPart()}`,this.serverUrl).toString()}async fetchResourceFromServer(t,e={}){if(e.setLoading){const o=new I(t);o.loading=!0,this.addResources(o,{skipCommitCompare:!0})}const r=this.getWebSocketForSubject(t);if(!e.fromProxy&&!e.noWebSocket&&It()&&(r==null?void 0:r.readyState)===WebSocket.OPEN)await yr(r,t);else{const o=this.agent?{agent:this.agent,serverURL:this.getServerUrl()}:void 0,{createdResources:i}=await this.client.fetchResourceHTTP(t,{from:e.fromProxy?this.getServerUrl():void 0,method:e.method,body:e.body,signInfo:o});this.addResources(i,{skipCommitCompare:!0})}return this.resources.get(t)}getAllSubjects(){return Array.from(this.resources.keys())}getDefaultWebSocket(){return this.webSockets.get(this.getServerUrl())}getWebSocketForSubject(t){const e=new URL(t),r=this.webSockets.get(e.origin);if(r)return r;typeof window<"u"&&this.webSockets.set(e.origin,le(e.origin,this))}getServerUrl(){return this.serverUrl}getAgent(){return this.agent??void 0}getResourceLoading(t=V,e={}){if(t===V||t===null){const o=new I(V,e.newResource);return o.setStore(this),o}let r=this.resources.get(t);if(r)!e.allowIncomplete&&r.loading===!1&&r.get(A.properties.incomplete)&&(r.loading=!0,this.addResources(r),this.fetchResourceFromServer(t,e));else return r=new I(t,e.newResource),r.loading=!0,this.addResources(r),e.newResource||this.fetchResourceFromServer(t,e),r;return r}async getResourceAsync(t){return this.getResource(t)}async getResource(t){const e=this.resources.get(t);if(e&&e.isReady())return e;if(e&&!e.isReady())return new Promise((o,i)=>{const n=c=>{this.unsubscribe(t,n),o(c)};this.subscribe(t,n),setTimeout(()=>{this.unsubscribe(t,n),i(new Error(`Async Request for subject "${t}" timed out after 5000ms.`))},5e3)});const r=await this.fetchResourceFromServer(t);return this.subscribeWebSocket(t),r}async getProperty(t){var c;const e=await this.getResource(t);if(e===void 0)throw Error(`Property ${t} is not found`);if(e.error)throw Error(`Property ${t} cannot be loaded: ${e.error}`);const r=e.get(A.properties.datatype);if(r===void 0)throw Error(`Property ${t} has no datatype: ${e.getPropVals()}`);const o=e.get(A.properties.shortname);if(o===void 0)throw Error(`Property ${t} has no shortname: ${e.getPropVals()}`);const i=e.get(A.properties.description);if(i===void 0)throw Error(`Property ${t} has no description: ${e.getPropVals()}`);const a=(c=e.get(A.properties.classtype))==null?void 0:c.toString();return{subject:t,classType:a,shortname:o.toString(),description:i.toString(),datatype:xe(r.toString()),allowsOnly:e.get(A.properties.allowsOnly)}}notifyError(t){const e=t instanceof Error?t:new Error(t);if(this.eventManager.hasSubscriptions("error"))this.eventManager.emit("error",e);else throw e}isOffline(){var t;return gt()?!((t=window==null?void 0:window.navigator)!=null&&t.onLine):!1}async notifyResourceSaved(t){await this.eventManager.emit("resource-saved",t)}async notifyResourceManuallyCreated(t){await this.eventManager.emit("resource-manually-created",t)}parseMetaTags(){const t=document.querySelectorAll('meta[property="json-ad-initial"]'),e=new G;t.forEach(r=>{const o=r.getAttribute("content");if(o===null)return;const i=JSON.parse(atob(o)),[a,n]=e.parseObject(i);this.addResources(n)})}async preloadPropsAndClasses(){const t=new URL("/classes",this.serverUrl),e=new URL("/properties",this.serverUrl);t.searchParams.set("include_external","true"),e.searchParams.set("include_external","true"),t.searchParams.set("include_nested","true"),e.searchParams.set("include_nested","true"),t.searchParams.set("page_size","999"),e.searchParams.set("page_size","999"),await Promise.all([this.fetchResourceFromServer(t.toString()),this.fetchResourceFromServer(e.toString())])}async postToServer(t,e){return this.fetchResourceFromServer(t,{body:e,noWebSocket:!0,method:"POST"})}removeResource(t){const e=this.resources.get(t);e&&(this.resources.delete(t),this.eventManager.emit("resource-removed",e))}async renameSubject(t,e){U.tryValidSubject(e);const r=t.subject;if(await this.checkSubjectTaken(e))throw Error(`New subject name is already taken: ${e}`);t.setSubject(e);const o=this.subscribers.get(r)??[];this.subscribers.set(e,o),this.removeResource(r),this.addResources(t)}setAgent(t){this.agent=t,t&&t.subject?(gt()&&ee(this.serverUrl,t),this.webSockets.forEach(e=>{e.readyState===e.OPEN?Dt(e,this,!0):e.onopen=()=>{Dt(e,this,!0)}})):gt()&&$e(),this.eventManager.emit("agent-changed",t)}setServerUrl(t){if(U.tryValidSubject(t),t.substring(-1)==="/")throw Error("baseUrl should not have a trailing slash");this.serverUrl=t,this.eventManager.emit("server-url-changed",t),It()&&this.openWebSocket(t)}openWebSocket(t){if(It()){if(this.webSockets.has(t))return;this.webSockets.set(t,le(t,this))}else console.warn("WebSockets not supported, no window available")}subscribe(t,e){if(t===void 0)throw Error("Cannot subscribe to undefined subject");let r=this.subscribers.get(t);return r===void 0&&(this.subscribeWebSocket(t),r=[]),r.push(e),this.subscribers.set(t,r),()=>{this.unsubscribe(t,e)}}subscribeWebSocket(t){if(t!==V)try{const e=this.getWebSocketForSubject(t);(e==null?void 0:e.readyState)===1&&(e==null||e.send(`SUBSCRIBE ${t}`))}catch(e){console.error(e)}}unSubscribeWebSocket(t){var e;if(t!==V)try{(e=this.getDefaultWebSocket())==null||e.send(`UNSUBSCRIBE ${t}`)}catch(r){console.error(r)}}unsubscribe(t,e){if(t===void 0)return;let r=this.subscribers.get(t);r&&(r=r==null?void 0:r.filter(o=>o!==e),this.subscribers.set(t,r))}on(t,e){return this.eventManager.register(t,e)}async uploadFiles(t,e){const r=this.getAgent();if(!r)throw Error("No agent set, cannot upload files");const o=await this.client.uploadFiles(t,this.getServerUrl(),r,e);return this.addResources(o),o.map(i=>i.subject)}async postCommit(t,e){return this.client.postCommit(t,e)}async getResourceAncestry(t){const e=[t.subject];let r=t.get(A.properties.parent);for(r&&e.push(r);r;){const o=await this.getResource(r);if(o){if(r=o.get(A.properties.parent),e.includes(r))throw new Error(`Resource ${t.subject} ancestry is cyclical. ${r} is already in the ancestry}`);e.push(r)}}return e}clientSideQuery(t){return Array.from(this.resources.values()).filter(t)}batchResource(t){const e=this._resources.get(t);if(!e)throw new Error(`Resource ${t} can not be saved because it is not in the store.`);const r=e.get(A.properties.parent);if(r===void 0)throw new Error(`Resource ${t} can not be added to a batch because it's missing a parent.`);this.batchedResources.has(r)?this.batchedResources.get(r).add(t):this.batchedResources.set(r,new Set([t]))}async saveBatchForParent(t){const e=this.batchedResources.get(t);if(e){for(const r of e){const o=this._resources.get(r);await(o==null?void 0:o.save())}this.batchedResources.delete(t)}}async importJsonAD(t,e){const r=new URL(Jt.import,this.serverUrl);r.searchParams.set("parent",e.parent),r.searchParams.set("overwrite-outside",e.overwriteOutside?"true":"false");const o=await this.postToServer(r.toString(),t);if(o.error)throw o.error}randomPart(){return ur().toLowerCase()}async findAvailableSubject(t,e,r=!0){let o=new URL(`${e}/${t}`).toString();if(!r){const a=this.randomPart();o+=`-${a}`}return await this.checkSubjectTaken(o)?this.findAvailableSubject(t,e,!1):o}async notify(t){const e=t.subject,r=this.subscribers.get(e);r!==void 0&&Promise.allSettled(r.map(async o=>o(t)))}}function vr(s,t,e){let r=s.replace(/(^\w+:|^)\/\//,"");if(typeof window<"u"&&(window!=null&&window.location)&&r.startsWith(window.location.hostname)&&(r=r.slice(window.location.hostname.length)),r.length<=t)return r;if(e){const o=r.length-t;return"..."+r.slice(o)}return r.slice(0,t)+"..."}Je();exports.Agent=se;exports.AtomicError=C;exports.Client=U;exports.Collection=Ct;exports.CollectionBuilder=Ne;exports.CommitBuilder=tt;exports.Datatype=Kt;exports.ErrorType=Q;exports.JSONADParser=G;exports.Resource=I;exports.ResourceEvents=Be;exports.RightType=Oe;exports.Store=br;exports.StoreEvents=Ke;exports.__INTERNAL_GET_KNOWN_SUBJECT_MAPPING=Ge;exports.applyCommitToResource=Xt;exports.buildSearchSubject=We;exports.checkAuthenticationCookie=Me;exports.classes=Ue;exports.collections=Rt;exports.commits=vt;exports.core=A;exports.createAuthentication=Qt;exports.dataBrowser=ye;exports.datatypeFromUrl=xe;exports.datatypes=_e;exports.endpoints=Jt;exports.escapeTantivyKey=Le;exports.generateKeyPair=Ls;exports.generatePublicKeyFromPrivate=ke;exports.getKnownNameBySubject=ge;exports.getTimestampNow=jt;exports.instances=Gt;exports.isArray=xt;exports.isAtomicError=Bs;exports.isNumber=Vt;exports.isString=Y;exports.isUnauthorized=je;exports.parseAndApplyCommit=Fe;exports.parseCommitJSON=Yt;exports.parseCommitResource=Te;exports.properties=N;exports.proxyCollection=Os;exports.proxyResource=$s;exports.registerOntologies=fe;exports.removeCachedSearchResults=Xs;exports.removeCookieAuthentication=$e;exports.reverseDatatypeMapping=_s;exports.serializeDeterministically=qt;exports.server=nt;exports.setCookieAuthentication=ee;exports.signRequest=$t;exports.signToBase64=Zt;exports.signatureMessage=te;exports.truncateUrl=vr;exports.unknownSubject=V;exports.urls=b;exports.valToArray=yt;exports.valToBoolean=ks;exports.valToDate=Ts;exports.valToNumber=Fs;exports.valToResource=Ms;exports.valToString=Is;exports.validateDatatype=Ce;
